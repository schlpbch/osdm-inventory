openapi: 3.0.3

info:
  title: NOVA Inventory Booking API
  version: 1.1.0-rc1
  description: >-
    NOVA Inventory API to book places in a inventory.
  contact:
    name: Andreas Schlapbach
    email: andreas.schlapbach@sbb.ch

servers:
  - description: NOVA Inventory Booking API
    url: https://developers.sbb.ch/nova-inventory-booking

tags:
  - name: place availabilities
    description: >-
      place availability of vehicle

paths:
  /place-availabilities:
    post:
      tags:
        - place availabilities
      summary: returns place availability of a vehicle
      description: >-
        Returns availability of places. The availability can be filtered using place properties or service levels.
      operationId: getAvailabilities
      parameters:
        - $ref: "#/components/parameters/traceParent"
        - $ref: "#/components/parameters/traceState"
      requestBody:
        description: request for availability
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PlaceAvailabilityRequest"
      responses:
        "200":
          description: the requested place
          headers:
            Cache-Control:
              schema:
                type: string
                default: "public, max-age=10000"
                description: >-
                  A places resource is fairly persistent and has a medium time to live to allow short-term caching.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PlaceAvailabilityResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          description: unauthorized
        "403":
          description: forbidden
        "404":
          $ref: "#/components/responses/InternalServerErrorResponse"
        "500":
          description: internal server error
        "501":
          description: not implemented
        "503":
          $ref: "#/components/responses/ServiceUnavailableResponse"

  /bookings:
    post:
      tags:
        - bookings
      summary: returns reservation of a vehicle in the state pre-booked
      description: >-
        Returns a booking in state pre-booked.
      operationId: postBooking
      requestBody:
        description: request for booking
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BookingRequest"
      responses:
        "200":
          description: the requested place
          headers:
            Cache-Control:
              schema:
                type: string
                default: "public, max-age=10000"
                description: >-
                  A booking resource is fairly persistent and has a medium time to live to allow short-term caching.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BookingResponse"
        "400":
          description: bad input parameter
        "401":
          description: unauthorized
        "403":
          description: forbidden
        "404":
          description: no place information found
        "500":
          description: internal server error
        "501":
          description: not implemented
        "503":
          description: service unavailable

    patch:
      tags:
        - bookings
      summary: allows updating the fulfillment type of the booking.
      operationId: confirmBooking
      parameters:
        - $ref: "#/components/parameters/acceptLanguage"
        - $ref: "#/components/parameters/idempotencyKey"
        - $ref: "#/components/parameters/traceParent"
        - $ref: "#/components/parameters/traceState"
        - in: path
          name: bookingId
          schema:
            type: string
          required: true
          description: id of the booking to be patched
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BookingPatchRequest"
      responses:
        "200":
          description: booking fulfillment type updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BookingResponse"
        "400":
          $ref: "#/components/responses/BadRequestResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden
        "404":
          description: Not Found
        "409":
          $ref: "#/components/responses/ConflictResponse"
        "500":
          $ref: "#/components/responses/InternalServerErrorResponse"
        "501":
          description: Not implemented
        "503":
          $ref: "#/components/responses/ServiceUnavailableResponse"

  /bookings/{bookingId}:
    delete:
      tags:
        - bookings
      summary: cancel a booking of a vehicle
      description: >-
        Cancels a booking.
      operationId: deleteBooking
      parameters:
        - in: path
          name: bookingId
          schema:
            type: string
            description: unique and opaque ID of the booking
          required: true
          description: ID of the booking to cancel.
      responses:
        "200":
          description: booking confirmed
        "400":
          description: bad input parameter
        "401":
          description: unauthorized
        "403":
          description: forbidden
        "404":
          description: no place information found
        "500":
          description: internal server error
        "501":
          description: not implemented
        "503":
          description: service unavailable

security:
  - oAuth2ClientCredentials: []

components:
  securitySchemes:
    oAuth2ClientCredentials:
      type: oauth2
      description: See https://swagger.io/docs/specification/authentication/oauth2/
      flows:
        clientCredentials:
          # The token endpoint of the authorization server, needs to be specified here
          tokenUrl: "https://login.microsoftonline.com/tbd"
          scopes: {} # The scopes are not being used yet

  parameters:
    acceptLanguage:
      name: Accept-Language
      in: header
      description: >-
        Describes the set of natural languages that are preferred for localized text in the response
        to the request (see RFC2616-sec14.4). Supporting English (en) is a must.
      schema:
        type: string
      required: false

    idempotencyKey:
      name: Idempotency-Key
      in: header
      description: >-
        The HTTP Idempotency request header field can be used to carry idempotency key in order to make 
        non-idempotent HTTP methods such as POST or PATCH fault-tolerant.
      schema:
        type: string
      required: false

    traceParent:
      name: traceparent
      in: header
      description: >-
        The traceparent header describes the position of the incoming request in its trace graph in a portable, 
        fixed-length format. Its design focuses on fast parsing. Every tracing tool MUST properly set 
        traceparent even when it only relies on vendor-specific information in tracestate (see W3C Trace Context).
      schema:
        type: string
      required: false

    traceState:
      name: tracestate
      in: header
      description:
        The tracestate extends traceparent with vendor-specific data represented by a set of name/value pairs.
        Storing information in tracestate is optional (see W3C Trace Context).
      schema:
        type: string
      required: false

  responses:
    BadRequestResponse:
      description: Bad Request (400)
      content:
        "application/problem+json":
          schema:
            $ref: "#/components/schemas/Problem"

    ConflictResponse:
      description: Conflict (409)
      content:
        "application/problem+json":
          schema:
            $ref: "#/components/schemas/Problem"

    InternalServerErrorResponse:
      description: Internal Server Error (500)
      content:
        "application/problem+json":
          schema:
            $ref: "#/components/schemas/Problem"

    ServiceUnavailableResponse:
      description: Service Unavailable (503)
      content:
        "application/problem+json":
          schema:
            $ref: "#/components/schemas/Problem"

  schemas:
    PlaceAvailabilityRequest:
      type: object
      additionalProperties: false
      required:
        - tripSpecifications
        - passengerSpecifications
      properties:
        tripSpecifications:
          type: array
          items:
            $ref: "#/components/schemas/TripSpecification"
        passengerSpecifications:
          type: array
          items:
            $ref: "#/components/schemas/PassengerSpecification"
        embeddedParts:
          type: string
          enum:
            - PLACE_AVAILABILITIES
            - ALL
          default: ALL

    PlaceAvailabilityResponse:
      type: object
      additionalProperties: false
      required:
        - tripAvailabilities
      properties:
        warnings:
          $ref: "#/components/schemas/WarningCollection"
        tripAvailabilities:
          type: array
          items:
            $ref: "#/components/schemas/TripAvailability"

    TripAvailability:
      type: object
      additionalProperties: false
      description: >-
        Availability per leg for a given trip.
      required:
        - tripId
      properties:
        tripId:
          type: string
        placeAvailabilities:
          type: array
          items:
            $ref: "#/components/schemas/PlaceAvailability"
        reservationOffers:
          type: array
          items:
            $ref: "#/components/schemas/ReservationOffer"

    ReservationOffer:
      type: object
      additionalProperties: false
      required:
        - id
        - productCode
        - price
        - placeAvailabilityId
      properties:
        id:
          type: string
        productCode:
          type: string
          description: >-
            The product code expressed in the provider system (could be a
            mapping from an even lower-level provider).
          example: Reservierungsentgelt
        price:
          $ref: "#/components/schemas/Price"
        availableFulfillmentTypes:
          type: array
          items:
            $ref: "#/components/schemas/FulfillmentType"
        placeAvailabilityId:
          type: string

    PlaceAvailability:
      type: object
      additionalProperties: false
      required:
        - id
        - legId
        - passengerIds
        - inventory
        - accommodationType
        - accommodationSubType
      properties:
        id:
          type: string
          example: "id-1"
        legId:
          type: string
          example: "leg-1"
        passengerIds:
          type: array
          items:
            type: string
            example: "passenger-1"
        inventory:
          $ref: "#/components/schemas/Inventory"
        comfortClass:
          $ref: "#/components/schemas/ComfortClass"
        accommodationType:
          $ref: "#/components/schemas/AccommodationType"
        accommodationSubType:
          $ref: "#/components/schemas/AccommodationSubType"
        numericAvailability:
          description: number of places
          type: integer
          format: int32
          example: 22
        availablePlaceProperties:
          type: array
          items:
            $ref: "#/components/schemas/PlaceProperty"

    Inventory:
      type: string
      x-extensible-enum:
        - CAPRE
        - RESSYS

    ##

    TripSpecification:
      type: object
      additionalProperties: false
      description: >-
        A minimal trip specification from origin to destination.
      required:
        - externalRef
        - legs # EXT replaces tripLegs, fix to OJP submitted, see https://github.com/VDVde/OJP/issues/179
      properties:
        externalRef:
          description: >-
            External reference of this trip for referencing purposes. Unique within a trip specification.
          type: string
        legs:
          type: array
          items:
            $ref: "#/components/schemas/TripLegSpecification"
          minItems: 1

    TripLegSpecification:
      type: object
      additionalProperties: false
      description: >-
        A minimal trip leg specification.
      required:
        - externalRef
      properties:
        externalRef:
          description: >-
            External reference of this trip leg. Unique within trip result.
          type: string
        timedLeg:
          $ref: "#/components/schemas/TimedLegSpecification"
        transferLeg:
          $ref: "#/components/schemas/TransferLeg"
        # continuousLeg:
        #   $ref: "#/components/schemas/ContinuousLeg"

    TimedLegSpecification:
      type: object
      additionalProperties: false
      description: >-
        A minimal timed leg specification.
      required:
        - start # EXT legBoard renamed to start
        - end # EXT legAlight renamed to board
        - service
      properties:
        start:
          $ref: "#/components/schemas/LegBoardSpecification"
        intermediates:
          type: array
          items:
            $ref: "#/components/schemas/LegIntermediateSpecification"
        end:
          $ref: "#/components/schemas/LegAlightSpecification"
        service:
          $ref: "#/components/schemas/DatedJourney"
    TransferLeg: ## OJP # Reduced scope
      type: object
      additionalProperties: false
      description: >-
        A leg which links other legs of a trip where a transfer between different places is required. 
        Provided by OJP.
      required:
        - start # EXT renamed legStart
        - end # EXT renamed legEnd
      properties:
        continuousMode:
          $ref: "#/components/schemas/ContinuousMode"
        transferMode:
          $ref: "#/components/schemas/TransferMode"
        start:
          description: Stop/Station to board.
          $ref: "#/components/schemas/PlaceRef"
        end:
          description: Stop/Station to alight
          $ref: "#/components/schemas/PlaceRef"
        timeWindowStart: # Inlined from TimeWindow
          description: Time at which window begins.
          type: string
          format: date-time
        timeWindowEnd: # Inlined from TimeWindow
          description: Time at which window ends.
          type: string
          format: date-time
        duration:
          description: Overall duration of this interchange.
          type: string
          format: duration
          example: "PT20M"
        # walkDuration:  # Out of scope
        #   description: Walk time as part of the overall interchange duration.
        #   type: string
        #   format: duration
        #   example: "PT20M"
        # bufferTime:  # Out of scope
        #   description: Buffer time as part of the overall interchange duration. Buffer times, f.e. check in/out times, sometimes are mandatory for using certain services as f.e. airplanes, ferries or highspeed trains.
        #   type: string
        #   format: duration
        #   example: "0SM"
        # legDescription:  # Out of scope
        #   type: string
        # length:  # Out of scope
        #   type: number
        #   minimum: 0
        # attribute:  # Out of scope
        #   $ref: "#/components/schemas/GeneralAttribute"
        # pathGuidance:  # Out of scope
        #   $ref: "#/components/schemas/PathGuidance"
        situationFullRef:
          type: array
          items:
            $ref: "#/components/schemas/SituationFullRef"

    LegBoardSpecification:
      type: object
      additionalProperties: false
      description: Minimal leg board specification.
      required:
        - stopPlaceRef ## EXT stopPlaceRef instead of stopPointRef
        - serviceDeparture
      properties:
        stopPlaceRef:
          $ref: "#/components/schemas/StopPlaceRef" ## EXT stopPlaceRef instead of stopPointRef
        stopPlaceName:
          type: string
          example: Luzern
        serviceDeparture:
          description: >-
            Describes the departure situation at this leg board stop point (group of attributes
            of timetabled passing time, estimated passing time, observed passing time).
          $ref: "#/components/schemas/ServiceTime"

    LegIntermediateSpecification:
      type: object
      additionalProperties: false
      description: Minimal leg intermediate specification.
      required:
        - stopPlaceRef ## EXT stopPlaceRef instead of stopPointRef
        - serviceArrival
        - serviceDeparture
      properties:
        stopPlaceRef:
          $ref: "#/components/schemas/StopPlaceRef" ## EXT stopPlaceRef instead of stopPointRef
        stopPlaceName:
          type: string
          example: Luzern
        serviceArrival:
          description: >-
            Describes the arrival situation at this leg board stop point (group of attributes
            of timetabled passing time, estimated passing time, observed passing time).
          $ref: "#/components/schemas/ServiceTime"
        serviceDeparture:
          description: >-
            Describes the departure situation at this leg board stop point (group of attributes
            of timetabled passing time, estimated passing time, observed passing time).
          $ref: "#/components/schemas/ServiceTime"

    LegAlightSpecification:
      type: object
      additionalProperties: false
      description: Minimal leg alight specification
      required:
        - stopPlaceRef ## EXT stopPlaceRef instead of stopPointRef
        - serviceArrival
      properties:
        stopPlaceRef:
          $ref: "#/components/schemas/StopPlaceRef" ## EXT stopPlaceRef instead of stopPointRef
        stopPlaceName:
          type: string
          example: Luzern
        serviceArrival:
          description: >-
            Describes the arrival situation at this leg board stop point (group of attributes
            of timetabled passing time, estimated passing time, observed passing time).
          $ref: "#/components/schemas/ServiceTime"

    ServiceTime: ## OJP
      type: object
      additionalProperties: false
      description: >-
        Contains at least scheduled time, but can contain real time and estimated times. Provided by OJP.
      required:
        - timetabledTime
      properties:
        timetabledTime:
          type: string
          format: date-time
        estimatedTime:
          type: string
          format: date-time
        observedTime:
          type: string
          format: date-time

    DatedJourney: ## OJP # Reduced scope
      type: object
      additionalProperties: false
      description: >-
        Vehicle journey that runs at a specific date. Provided by OJP.
      required:
        # - operatingDayRef
        # - journeyRef
        # - mode
        # - publishedServiceName # EXT
        # - privateMode # EXT
        - operatorRefs
        # - originText
        # - destinationText
      properties:
        operatingDayRef:
          $ref: "#/components/schemas/OperationDayRef"
        # journeyRef:  # Out of scope
        #   $ref: "#/components/schemas/JourneyRef"
        mode:
          $ref: "#/components/schemas/Mode"
        productCategory:
          $ref: "#/components/schemas/ProductCategory"
        publishedServiceName:
          description: >-
            Line name or service description as known to the public, f.e. "512", "S8"
            or "Circle Line" or "ICE 488".
          type: string
          example: S1
        vehicleNumbers: # EXT Fix to OJP submitted, see https://github.com/VDVde/OJP/issues/173
          description: >-
            The vehicle number(s) of the vehicle(s) that runs this timed leg.
            On some legs a vehicle has multiple vehicles, e.g. if it is split into two
            trains at a intermediate stop.

            For backwards compatibility with Hermes/Hosa the length of the string must be restricted
            to 5 characters. If's longer, it is not possible to use the H2O converter.
          type: array
          items:
            type: string
            example:
              - "9218"
              - "9340"
              - "15"
        lineNumbers:
          description: >-
            List of line numbers that are part of this journey.
            Especially on regional traffic, a vehicle is defined by a line number only.
          type: array
          items:
            type: string
            example:
              - "52"
              - "19"
        operatorRefs:
          description: >-
            Reference to transport operators.
            For UIC see: https://unioninternationalcheminsdefer.github.io/OSDM/spec/catalog-of-code-lists/

            As a leg can be operated by more than operator we model it as an array here.
          type: array
          items:
            type: string
            example: "urn:uic:rics:1185:000011"
        serviceStatus:
          $ref: "#/components/schemas/ServiceStatus"
        situationFullRefs:
          type: array
          items:
            $ref: "#/components/schemas/SituationFullRef"

    Mode: ## OJP
      type: object
      additionalProperties: false
      description: >-
        A method of transportation such as bus, rail, etc. Provided by OJP.
      required:
        - ptMode
      properties:
        ptMode: # EXT
          description: >-
            Subset of SIRI Modes which are sensible.
            TAP-TSI/UIC: Transport Mode  TODO: Align with SIRI
          type: string
          x-extensible-enum:
            - HIGH_SPEED_TRAIN
            - HISTORIC_TRAIN
            - INTERCITY
            - REGIONAL
            - INTERREGIONAL
            - URBAN
            - TRAM
            - UNDERGROUND
            - NIGHT_TRAIN
            - SHARED_TAXI
            - MOTOR_RAIL
            - MOUNTAIN_TRAIN
            - PLANE
            - COACH_GROUP
            - SHIP
            - BUS

          #  $ref: "#/components/schemas/PtModeChoiceGroup"
        name:
          description: Name of the mode
          type: string
          example: rail
        shortName:
          description: Short name or acronym of the mode
          type: string
          example: S
        description:
          description: Additional text that further describes the mode
          type: string

    ProductCategory: ## OJP
      type: object
      additionalProperties: false
      description: >-
        Product category based on NeTEx/SIRI. A product category is a classification for vehicle journeys
        to express some common properties of journeys for marketing and fare products. Provided by OJP.
      required:
        - name
        - shortName
        - productCategoryRef
      properties:
        name:
          description: >-
            Full name of this product category, e.g. "TGV Lyria" in Switzerland and France.
            UIC: Long name of Service Brand
          type: string
          example: TGV Lyria
        shortName:
          description: >-
            Short name or acronym of the product category, likely to be published, e.g. "TGV"
            UIC: Abbreviation of Service Brand
          type: string
          example: TGV
        productCategoryRef:
          $ref: "#/components/schemas/ProductCategoryRef"

    ServiceStatus:
      type: object
      additionalProperties: false
      description: >-
        Parameters which describe the current status of a dated vehicle journey.
        Provided by OJP.
      properties:
        unplanned:
          type: boolean
          description: Whether this trip is an additional one that has not been planned.
          default: false
        cancelled:
          type: boolean
          description: Whether this trip is cancelled and will not be run.
          default: false
        deviation:
          type: boolean
          description: Whether this trip deviates from the planned service pattern.
          default: false
        occupancy:
          type: string
          description: >-
            Passenger load status on vehicle. If omitted, not known. 
            Equivalent to siri:OccupancyEnumeration which describes three values: 
            "full", "seatingAvailable" and "standingAvailable".

    ContinuousMode: ## OJP
      type: string
      description: Types of modes that run at any time without a timetable. Provided by OJP.
      x-extensible-enum:
        - WALK
        - DEMAND_RESPONSIVE
        - REPLACEMENT_SERVICE

    TransferMode: ## OJP
      type: string
      description: Modes dedicated to perform transfers. Provided by OJP.
      x-extensible-enum:
        - WALK
        - PARK_AND_RidE
        - BIKE_AND_RidE
        - CAR_HIRE
        - BIKE_HIRE
        - PROTECTED_CONNECTION
        - GUARANTEED_CONNECTION
        - REMAIN_IN_VEHICLE
        - CHANGE_WITHIN_VEHICLE
        - CHECK_IN
        - CHECK_OUT
      default: WALK

    PlaceRef: ### OJP
      oneOf:
        - $ref: "#/components/schemas/StopPlaceRef"
        - $ref: "#/components/schemas/PointOfInterestRef"
        - $ref: "#/components/schemas/AddressRef"
        - $ref: "#/components/schemas/FareConnectionPointRef"
        - $ref: "#/components/schemas/GeoPosition"
      discriminator:
        propertyName: placeRefType

    StopPlaceRef: ## OJP
      type: object
      additionalProperties: false
      description: >-
        Reference to a Stop Place using URNs to define code.
        For UIC see UIC MERITS/TAP-TSI station codes. Provided by OJP.
      required:
        - stopPlaceRef
      properties:
        placeRefType:
          type: string
          enum:
            - stopPlaceRef
        stopPlaceRef:
          type: string
          example: urn:uic:stn:8503000
        name:
          type: string

    PointOfInterestRef: ## OJP
      type: object
      additionalProperties: false
      description: >-
        Reference to a Point of Interest. Provided by OJP.
      required:
        - pointOfInterestRef
      properties:
        placeRefType:
          type: string
          enum:
            - pointOfInterestRef
        pointOfInterestRef:
          type: string
        name:
          type: string

    AddressRef: ## OJP
      type: object
      additionalProperties: false
      description: >-
        Reference to an Address.
      required:
        - addressRef
      properties:
        placeRefType:
          type: string
          enum:
            - addressRef
        addressRef:
          type: string
        name:
          type: string

    FareConnectionPointRef:
      type: object
      additionalProperties: false
      description: >-
        Reference to a Fare Connection Point.
      required:
        - fareConnectionPoint
      properties:
        placeRefType:
          type: string
          enum:
            - fareConnectionPointRef
        fareConnectionPoint:
          $ref: "#/components/schemas/FareConnectionPoint"
        name:
          type: string  

    SituationFullRef: ## OJP
      type: string
      description: >-
        Reference to situation message. Message details might be found in response 
        context or through other communication channels. Provided by OJP.

    ProductCategoryRef: ## OJP
      type: string
      description: >-
        Reference to a product category. Product categories should be defined once and used
        uniformly in all channels (e.g. NeTEx, SIRI, OJP). Provided by OJP.
      example: "urn:uic:sbc:76"

    OperationDayRef: ## OJP
      type: string
      description: Reference to an operating day. Provided by OJP.
      example: "OperatingDay:12345"

    ## Passenger Part

    Passenger:
      type: object
      additionalProperties: false
      description: passenger information needed at offering step
      required:
        - id
        - type
      properties:
        id:
          type: string
          description: >-
            Id of the passenger resource in case service to patch a single passenger is provided.
        abstract:
          type: string
          description: A human-readable description of the passenger.
          example: Andreas Schlapbach
        externalRef:
          description: >-
            A stable reference to a passenger from other elements, or from caller system.
            When received in input of a trip-offers-collection request, it must be echoed back in the
            response.
          type: string
        dateOfBirth:
          description: date of birth of the passenger
          type: string
          format: date
        type:
          $ref: "#/components/schemas/PassengerType"
        cards:
          description: reduction or loyalty cards owned by the passenger
          type: array
          items:
            $ref: "#/components/schemas/CardReference"
        #gender:
        #  $ref: "#/components/schemas/Gender"
        details:
          $ref: "#/components/schemas/PersonDetail"
        #passport:
        #  $ref: "#/components/schemas/IdentificationDocument"
        transportableDetails:
          $ref: "#/components/schemas/Transportable"
        prmNeeds:
          type: array
          description: >-
            For the persons with reduced mobility (PRMs) its specific needs for support are expressed.
          items:
            $ref: "#/components/schemas/PRMNeedType"
        _links:
          type: array
          items:
            $ref: "#/components/schemas/Link"

    Transportable:
      type: object
      additionalProperties: false
      description: >-
        Transportables which are handled similar to passengers like dogs, bicycles, car transport.
        These transportables might need a ticket or reservation.
      required:
        - type
      properties:
        type:
          description: >-
            Subset of the values from the passenger type code list IRS 90918-10
          type: string
          x-extensible-enum:
            - PET
            - BICYCLE

    PassengerSpecification:
      type: object
      additionalProperties: false
      description: >-
        Minimal specification of a passenger to request offers.
      required:
        - externalRef
        - type
      properties:
        externalRef:
          description: >-
            A stable reference to a passenger from other elements, or from caller system.
            When received in input of a trip-offers-collection request, it must be echoed back in the
            response.
          type: string
          example: "TK-id-12345"
        type:
          $ref: "#/components/schemas/PassengerType"
        dateOfBirth:
          description: >-
            Date of birth of the passenger. Only needed for passengers of type persons, family child, PRMS
            and wheelchair.
          type: string
          format: date
        cards:
          description: reduction or loyalty cards owned by the passenger
          type: array
          items:
            $ref: "#/components/schemas/CardReference"
        prmNeeds:
          type: array
          description: >-
            For the persons with reduced mobility (PRMs) its specific needs for support are expressed.
          items:
            $ref: "#/components/schemas/PRMNeedType"

    PassengerType:
      type: string
      description: >-
        Passenger type according to UIC passenger, i.e. passenger type list.
        See https://unioninternationalcheminsdefer.github.io/OSDM/spec/catalog-of-code-lists/
      x-extensible-enum:
        - DOG
        - PET
        - LUGGAGE
        - PRM
        - BICYCLE
        - PRAM
        - ACCOMP_DOG
        - CAR
        - PERSON
        - MOTOCYCLE
        - TRAILER
        - FAMILY_CHILD
        - WHEELCHAR
      example: PERSON
      default: PERSON

    CardReference:
      type: object
      additionalProperties: false
      required:
        - types
        - code
      properties:
        types:
          description: Types of card. One card can have multiple roles, such as loyalty and reduction
          type: array
          items:
            $ref: "#/components/schemas/CardType"
        code:
          description: Code of the card type according to issuer.
          type: string
        name:
          description: Card name for printing on fulfillments.
          type: string
        number:
          description: Unique number identifying the card.
          type: string
        issuer:
          $ref: "#/components/schemas/Company"

    PRMNeedType:
      type: string
      x-extensible-enum:
        - NEED_PRM_SUPPORT
        - WHEELCHAIR
        - ACCOMPANYING_DOG
        - COMPANION_SEAT
        - COMPANION

    CardType:
      type: string
      x-extensible-enum:
        - REDUCTION_CARD
        - LOYALTY_CARD
        - CHIP_CARD
        - PASS
      default: REDUCTION_CARD

    Company:
      type: string
      description: RICS company code or compatible ERA company code for rail.
      example: "urn:uic:rics:1185"

    ## Offer Part

    OfferPartReference:
      type: object
      additionalProperties: false
      description: >-
        References all the offer part elements in an uniform format.
        In its part, an OfferPartReference can refer to reservation, admission, ancillary or fee.
      required:
        - id
      properties:
        id:
          type: string
        abstract:
          type: string
          description: A human-readable description of the offer part reference.
          example: ICE Wifi on Board of train ICE 3, 2022-07-11
        _links:
          type: array
          items:
            $ref: "#/components/schemas/Link"

    PlaceProperty:
      type: string
      description: see code list

    AccommodationType:
      type: string
      description: >-
        Accommodation type definition out of the Accommodation Type Code List
      default: SEAT

    AccommodationSubType:
      type: string
      description: >-
        Accommodation type definition out of the Accommodation Sub Type Code List

    ComfortClass:
      type: string
      description: >-
        Generic class classification, mostly used to harmonize choice and
        representation across multiple carriers.
      x-extensible-enum:
        - FIRST
        - SECOND

    Flexibility:
      type: string
      x-extensible-enum:
        - FULL_FLEXIBLE
        - SEMI_FLEXIBLE
        - NON_FLEXIBLE

    Price:
      type: object
      additionalProperties: false
      required:
        - currency
        - amount
      properties:
        currency:
          $ref: "#/components/schemas/Currency"
        amount:
          description: amount in cents
          type: integer
          format: int32
        scale:
          description: scale of the amount - the number of positions after the comma
          type: integer
          format: int32
          default: 2
        vats:
          type: array
          items:
            $ref: "#/components/schemas/VAT"

    Currency:
      type: string
      description: ISO 4217 currency codes
      example:
        - CHF
        - EUR
        - SEK

    VAT:
      type: object
      additionalProperties: false
      required:
        - countryCode
        - amount
      properties:
        countryCode:
          $ref: "#/components/schemas/CountryCode"
        amount:
          description: amount in cents
          type: integer
          format: int32
          example: 5
        scale:
          description: scale of the amount - the number of positions after the comma
          type: integer
          format: int32
          default: 2
        percentage:
          type: number
          format: float
        taxId:
          type: string
        scope:
          $ref: "#/components/schemas/VatScope"

    VatScope:
      type: string
      description: scope where the VAT applies
      x-extensible-enum:
        - INTERNATIONAL
        - NATIONAL
        - SHORT_DISTANCE
        - LONG_DISTANCE

    FulfillmentType:
      type: string
      x-extensible-enum:
        - ETICKET
        - CIT_PAPER
        - PASS_CHIP
        - PASS_REFERENCE

    ## Booking

    BookingRequest:
      type: object
      additionalProperties: false
      description: >-
        place selection options and selected options in an offer
        - selected place properties (selectedOption)
        - reference place for adjacent reservation (selectedReferencePlace)
        - selected places from a graphical place selection (selectedCoaches)
      required:
        - selectionPerLegs
      properties:
        # purchaser:
        #  $ref: "#/components/schemas/Purchaser"
        offers:
          type: array
          items:
            $ref: "#/components/schemas/OfferSelection"
          description: >-
            The list of offers that need to be provisionally booked, with possibly the reservations and ancillaries associated that should be booked as well.

    OfferSelection:
      type: object
      additionalProperties: false
      required:
        - id
      properties:
        reservationOfferId:
          type: string
          description: id of the selected reservation offer id
        # placeAvailabilityId:
        #  type: string
        #  description: id of the selected availability id
        optionalReservationIds:
          type: array
          items:
            type: string
            description: >-
              If relevant, ids of the selected optional reservations.
        optionalAncillaryIds:
          type: array
          items:
            type: object
            properties:
              ancillaryId:
                type: string
                description: >-
                  If relevant, ids of the selected optional ancillaries.
              passengerIds:
                type: array
                items:
                  type: string
                  description: >-
                    Id of the passengers the selected optional ancillaries are for.
        passengers:
          type: array
          items:
            $ref: "#/components/schemas/Passenger"
          description: >-
            If needed (cf requiredInformation) or desired, this array allows providing the required details on some or all passengers
        placeSelections:
          type: object
          properties:
            reservationId:
              type: string
            placeSelection:
              $ref: "#/components/schemas/SelectedPlaceOption"

    SelectedPlaceOption:
      type: object
      additionalProperties: false
      description: >-
        Place selection options and selected options in an offer
        - reference place for adjacent reservation
        - selected optional place properties
        - selected places from a graphical place selection
      properties:
        reservationOptions:
          $ref: "#/components/schemas/ReservationOption"
        vehicle:
          description: >-
            Vehicle / train number is necessary in case of train parts with different train numbers
          type: string
        referencePlace:
          $ref: "#/components/schemas/SelectedReferencePlace"
        options:
          type: array
          items:
            $ref: "#/components/schemas/SelectedOption"
        coaches:
          type: array
          items:
            $ref: "#/components/schemas/SelectedCoach"

    ReservationOption:
      type: object
      additionalProperties: false
      properties:
        preferences:
          description: possible preferences to be requested in reservation without changing the fare
          type: array
          items:
            $ref: "#/components/schemas/ReservationOptionGroup"
        graphicalReservation:
          description: graphical reservation is supported, interface type "NO","UIC_918",..
          type: string

    ReservationOptionGroup:
      type: object
      additionalProperties: false
      required:
        - preferenceGroup
        - preferences
      properties:
        preferenceGroup:
          type: string
          example: SEAT_DIRECTION
        preferences:
          type: array
          items:
            type: string
            example: "FORWARD_FACING"

    SelectedReferencePlace:
      type: object
      additionalProperties: false
      description: reference place for an adjacent reservation
      properties:
        coachNumber:
          type: string
        placeNumber:
          type: string

    SelectedOption:
      type: object
      additionalProperties: false
      description: >-
        Place selection of places for reservation linked to passengers.
      required:
        - passengerIds
        - accommodationType
        - accommodationSubType
      properties:
        passengerIds:
          type: array
          items:
            description: Id of the passenger
            type: string
        accommodationType:
          $ref: "#/components/schemas/AccommodationType"
        accommodationSubType:
          $ref: "#/components/schemas/AccommodationSubType"
        placeProperties:
          description: Properties of places as defined in 90810-10.
          type: array
          items:
            description: selection from the optional place properties provided in the offer
            type: string

    SelectedCoach:
      type: object
      additionalProperties: false
      properties:
        coachNumber:
          type: string
          description: selected coach in case of graphical booking
        places:
          type: array
          items:
            $ref: "#/components/schemas/SelectedPlace"

    SelectedPlace:
      type: object
      additionalProperties: false
      description: selected place in case of graphical booking
      properties:
        passengerId:
          description: Id of the passenger
          type: string
        placeNumber:
          type: string

    Purchaser:
      type: object
      additionalProperties: false
      description: purchaser information
      required:
        - id
        - details
      properties:
        id:
          type: string
        externalRef:
          description: >-
            A stable reference to a purchaser from other elements, or from caller system.
            When received in input of a trip-offers-collection request, it must be echoed back in the
            response.
          type: string
        details:
          $ref: "#/components/schemas/PersonDetail"
        _links:
          $ref: "#/components/schemas/Link"

    PersonDetail:
      type: object
      additionalProperties: false
      description: >-
        Personal information potentially needed at booking step. To support privacy by design,
        it is not permitted to send personal information not required to create a valid booking.
      required:
        - firstName
        - lastName
      properties:
        preferredLanguage:
          type: string
          description: ISO-639-1 language code
        abstract:
          type: string
          description: A human-readable description of the person.
          example: Andreas Schlapbach, Riedweg 4, 3074 Bern, schlpbch@gmail.com
        firstName:
          type: string
        lastName:
          type: string
        eMail:
          type: string
        phoneNumber:
          description: >-
            Preferably a mobile phone number, to be contacted in case changes to the booking occur, e.g.,
            in case of interruptions.
          type: string
        address:
          description: Address of the person, relevant for some pass holders
          $ref: "#/components/schemas/Address"

    Address: ## OJP # Reduced scope
      type: object
      additionalProperties: false
      description: >-
        A descriptive data associated with a place that can be used to describe the unique geographical context of a
        place for the purposes of identifying it. may be refined as either a road address, a postal address or both.
        Provided by OJP.
      # allOf:
      required:
        - code # EXT code instead of addressCode, see https://github.com/VDVde/OJP/issues/183
        - name # EXT name instead of addressName, see https://github.com/VDVde/OJP/issues/183
      properties:
        code:
          description: id of the address
          type: string
          example: NL:1916200000022621
        # privateCode:  # Out of scope
        #   description: Code of this address in private/foreign/proprietary coding schemes.
        #   $ref: "#/components/schemas/PrivateCode"
        name:
          description: Name or description of address for use in passenger information.
          type: string
          example: Oude Trambaan 7, 2265CA Leidschendam, Nederland
        # nameSuffix:  # Out of scope
        #   description: House number of the address. If none is given, either a crossing street can be given, or the whole street is meant.
        #   type: string
        # - $ref: "#/components/schemas/AddressDetail"
        countryName:
          description: Country of the address.
          type: string
          example: The Netherlands
        countryCode:
          $ref: "#/components/schemas/CountryCode"
        postCode:
          description: Postal code of the address.
          type: string
          example: 2265CA
        city: # EXT
          description: City name
          type: string
          example: Leidschendam
        topographicPlaceName:
          description: >-
            TopographicPlace name of the address. If set it should at least contain the city name.
          type: string
          example: Leidschendam
        # topographicPlaceRef:  # Out of scope
        #   description: If at least one is set, only place objects within the given localities are allowed.If at least one is set, only place objects within the given localities are allowed.Reference to a TopographicPlace
        #   $ref: "#/components/schemas/TopographicPlaceRef"
        street:
          description: Street name of the address.
          type: string
          example: Oude Trambaan
        houseNumber:
          description: House number of the address. If none is given, either a crossing street can be given, or the whole street is meant.
          type: string
          example: 7
        # crossRoad:  # Out of scope
        #   description: Crossing. This can be used to be more specific without using house numbers.
        #   type: string

    BookingResponse:
      type: object
      additionalProperties: false
      properties:
        warnings:
          $ref: "#/components/schemas/WarningCollection"
        booking:
          $ref: "#/components/schemas/Booking"

    Booking:
      type: object
      additionalProperties: false
      required:
        - id
        - status
        - passengers
      properties:
        id:
          type: string
        abstract:
          type: string
          description: A human-readable description of the booking.
          example: Booking 2345 for Clemens Gantert
        reference:
          type: string
          description: >-
            The unique booking reference in the provider system. Usually refers to an order number or PNR.
        status:
          $ref: "#/components/schemas/BookingStatus"
        provisionalPrice:
          $ref: "#/components/schemas/Price"
        confirmedPrice:
          $ref: "#/components/schemas/Price"
        #requestedInformation:
        #  $ref: "#/components/schemas/RequestedInformation"
        ticketTimeLimit:
          type: string
          format: date-time
        fulfillmentType:
          $ref: "#/components/schemas/FulfillmentType"
        bookedOffers:
          type: array
          items:
            $ref: "#/components/schemas/BookedOffer"
        #appliedPromoCodes:
        #  type: array
        #  items:
        #    $ref: "#/components/schemas/PromotionCode"
        purchaser:
          description: >-
            Some caller do want to provide information about the purchaser, thus this attribute 
            can not be made mandatory.
          $ref: "#/components/schemas/Purchaser"
        passengers:
          type: array
          items:
            $ref: "#/components/schemas/Passenger"
        fulfillments:
          type: array
          items:
            $ref: "#/components/schemas/Fulfillment"
        # refundOffers:
        #   type: array
        #   items:
        #     $ref: "#/components/schemas/RefundOffer"
        #   description: >-
        #     Refund offers are created with the details of the to-be-confirmed refund operation.
        #     One refund offer can then be confirmed, which turns it into a refund.
        _links:
          type: array
          items:
            $ref: "#/components/schemas/Link"

    BookingStatus:
      type: string
      enum:
        - PREBOOKED
        - CONFIRMED
        - FULFILLED
        - CANCELLED
        - REFUNDED
        - EXCHANGE_ONGOING
        - ERROR

    BookedOffer:
      description: >-
        The attribute 'offerSummary' is meaningful at trip-offer-collection response time only.
      type: object
      additionalProperties: false
      properties:
        id:
          type: string
        abstract:
          type: string
          description: A human-readable description of the booked offer.
          example: Bruxelles-Midi - Paris-Nord 2022-07-01 10:05 CET, Normal Fare, 50 €
        coveredLegIds:
          type: array
          items:
            type: string
          description: >-
            Indicate which legs are covered by the specific offer. Not used for fares.
        trip: ## Hack
          $ref: "#/components/schemas/TripSpecification"
          description: >-
            This trip will be included in the offer if the offer is part of the booking.
        # admissions:
        #   type: array
        #   items:
        #     $ref: "#/components/schemas/Admission"
        reservations:
          type: array
          items:
            $ref: "#/components/schemas/Reservation"
        ancillaries:
          type: array
          items:
            $ref: "#/components/schemas/Ancillary"
        # fees:
        #   type: array
        #   items:
        #     $ref: "#/components/schemas/Fee"
      required:
        - id

    Reservation:
      type: object
      additionalProperties: false
      description: >-
        Reservation includes the reference to the in the initial offer. 
        The offer needs to be updated with the selected places before the confirmation
        which creates the reservation details including the reserved places.
      required:
        - id
        - commonOfferPartAttributes
        - reservationDetail
      properties:
        id:
          type: string
        commonOfferPartAttributes:
          $ref: "#/components/schemas/CommonOfferPartAttributes"
        reservationDetail:
          $ref: "#/components/schemas/ReservationDetail"
        placeSelection:
          $ref: "#/components/schemas/SelectedPlaceOption"
        optionality:
          description: >-
            INCLUDED: the reservation is included in the offer
            MANDATORY: the reservation is mandatory for the booking
            OPTIONAL: the reservation is not included but can be added optionally
          type: string
          enum:
            - INCLUDED
            - MANDATORY
            - OPTIONAL
        ancillaries:
          type: array
          items:
            type: object
            properties:
              relationType:
                type: string
                enum:
                  - OPTIONAL
                  - INCLUDED
              ancillary:
                $ref: "#/components/schemas/OfferPartReference"
        fees:
          type: array
          items:
            $ref: "#/components/schemas/OfferPartReference"

    Ancillary:
      type: object
      additionalProperties: false
      required:
        - id
        - commonOfferPartAttributes
      properties:
        id:
          type: string
        commonOfferPartAttributes:
          $ref: "#/components/schemas/CommonOfferPartAttributes"
        optionality:
          description: >-
            INCLUDED: the ancillary is included in the offer but is not mandatory 
            OPTIONAL: the ancillary is not included but can be optionally added
          type: string
          enum:
            - INCLUDED
            - OPTIONAL
        category:
          type: string
        fees:
          type: array
          items:
            $ref: "#/components/schemas/OfferPartReference"

    CommonOfferPartAttributes:
      type: object
      additionalProperties: false
      properties:
        price:
          $ref: "#/components/schemas/Price"
        pricingMode:
          type: string
          enum:
            - COLLECTIVE
            - INDIVIDUAL
          default: INDIVIDUAL
        appliedReductions:
          type: array
          items:
            $ref: "#/components/schemas/CardReference"
        appliedPromotionCodes:
          type: array
          items:
            $ref: "#/components/schemas/PromotionCode"
        passengerIds:
          type: array
          items:
            description: Id of the passenger
            type: string
        providerBookingReference:
          type: string
          description: >-
            The booking reference of the booking the offer part is in on the provider side.
        finalProviderBookingReference:
          type: string
          description: >-
            The booking reference of the order the offer part is in on the final provider 
            side = the provider actually hosting or allocating  the product.
        availableFulfillmentOptions:
          type: array
          items:
            $ref: "#/components/schemas/FulfillmentOption"
        validFrom:
          type: string
          format: date-time
          description: Validity of offer towards passenger
        validUntil:
          type: string
          format: date-time
          description: Validity of offer towards passenger
        numericAvailability:
          type: integer
          format: int32
          description: >-
            If supported by the allocator system, this returns the number of remaining available
            offerparts, i.e. admissions, reservation or ancillaries.
        refundable:
          type: string
          description: >-
            If set to YES the offerpart is refundable without a fee before the day of departure.
            NO when not refundable or refundable with 100% fee, WITH_CONDITIONS in all other cases.
          enum:
            - YES
            - NO
            - WITH_CONDITIONS
        exchangeable:
          type: string
          description: >-
            If set to YES the offerpart is exchangeable without a fee before the day of departure. 
            NO when not exchangeable or exchangeable with 100% fee, WITH_CONDITIONS in all other cases.
          enum:
            - YES
            - NO
        afterSaleConditions:
          type: array
          description: Fine grained specification of the after sale condition of the booking.
          items:
            $ref: "#/components/schemas/AfterSaleCondition"
        products:
          type: array
          description: >-
            In offer mode, in almost all cases exactly one product is referenced. Only on some French
            trips consisting of a TGV and a TER two products need to be used.
            In fare mode, no product exists as first needs to created from the different fares.
          items:
            type: object
            properties:
              product:
                $ref: "#/components/schemas/Product"
              legIds:
                description: indices of the legs in the trip given by the provider of the offer
                type: array
                items:
                  type: string
      required:
        - price
        - passengerIds
        - validFrom
        - refundable
        - exchangeable

    PromotionCode:
      type: object
      additionalProperties: false
      description: >-
        The promotion code is a token that reduces the price at POST booking time OR
        Token that reduces the price at POST trip-offer-collection time OR
        Token to receive offers that are not available without it.
      properties:
        code:
          description: >-
            The code issued by the issuer
          type: string
          example: SPRING_DISCOUNT
        issuer:
          description: >-
            The party that issues the promotion code, in case of a railway it's its RICS code
          type: string

    ReservationDetail:
      type: object
      additionalProperties: false
      description: >-
        Describes the details of the reserved place(s).
      required:
        - accommodationType
        - accommodationSubType
      properties:
        accommodationType:
          $ref: "#/components/schemas/AccommodationType"
        accommodationSubType:
          $ref: "#/components/schemas/AccommodationSubType"
        reservedPlaces:
          description: >-
            Reserved places in a confirmed reservation. 
            Multiple place packs are needed to combined person and bicycle reservations
          type: array
          items:
            $ref: "#/components/schemas/ReservedPlace"

    ReservedPlace:
      type: object
      additionalProperties: false
      description: >-
        Selection of places with common properties description element - textual description of the places
        placeProperties is mandatory for allocator mode, for distributors the textual description is used
      required:
        - id
        - passengerIds
        - vehicle
        - coach
      properties:
        id:
          type: string
        passengerIds:
          type: array
          items:
            description: Id of the passenger
            type: string
        vehicle:
          description: vehicle number (e.g. train number)
          type: string
        coach:
          type: string
        places:
          description: descriptive string of the places (e.g. 11-35,51)
          type: string
        placeIds:
          description: list of individual place numbers
          type: array
          items:
            type: string
        placeProperties:
          description: place properties to be indicated to the customer
          type: array
          items:
            type: object
            description: >-
              Place properties of places in the place pack. Properties without a number refer 
              to all places.
            required:
              - placeProperty
            properties:
              placeProperty:
                $ref: "#/components/schemas/PlaceProperty"

    AfterSaleCondition:
      type: object
      additionalProperties: false
      properties:
        condition:
          $ref: "#/components/schemas/AfterSaleConditionType"
        validFrom:
          type: string
          format: date-time
        validUntil:
          type: string
          format: date-time
        afterSaleFee:
          $ref: "#/components/schemas/Price"

    AfterSaleConditionType:
      type: string
      x-extensible-enum:
        - PLACE_CHANGE
        - EXCHANGE
        - REFUND  

    Product:
      type: object
      additionalProperties: false
      description: >-
        Structured description of the product, its name, comfort and sales / after-sales conditions
      required:
        - id
        - code
      properties:
        id:
          type: string
          description: id of the product
        abstract:
          type: string
          description: A human-readable description of the product.
          example: TGV Lyria Loisir 2
        code:
          type: string
          description: >-
            The product code expressed in the provider system (could be a
            mapping from an even lower-level provider).
          example: PT00AD
        description:
          type: string
          description: Textual description of the product.
          example: Loisir Non-flex Adult Fare
        conditions:
          type: array
          items:
            $ref: "#/components/schemas/Condition"
          description: >-
            Structured description of the sales or after-sales conditions.
        serviceClass:
          $ref: "#/components/schemas/ServiceClass"
        comfortClass:
          $ref: "#/components/schemas/ComfortClass"
        isTrainBound:
          type: boolean
          default: false
        isReturnProduct:
          type: boolean
          default: false
        fulfillmentOptions:
          type: array
          items:
            $ref: "#/components/schemas/FulfillmentOption"
        serviceConstraintText:
          type: string
        carrierConstraintText:
          type: string
        tariff:
          type: string
          description: >-
            Mapping to Tariff 42 of IRS-90918-3 (Hermes/Hosa). Helps the H2O converter in mapping
            offers to a requested tariff. See legacyReservationParameter.tariff in OSDM offline.
        throughTicketTags:
          type: array
          items:
            type: string
          description: >-
            List of tags (and their type) that allow identifying sets of offers for which related 
            contracts can be grouped into one through ticket.
        combinationTags:
          type: array
          items:
            $ref: "#/components/schemas/CombinationTag"
        _links:
          type: array
          items:
            $ref: "#/components/schemas/Link"

    ServiceClass:
      type: object
      additionalProperties: false
      description: Class of service.
      required:
        - type
        - name
      properties:
        type:
          $ref: "#/components/schemas/ServiceClassType"
        name:
          type: string
          description: The name the carrier itself uses to designate this specific service class

    ServiceClassType:
      type: string
      description: >-
        Type of quality level, finer grained than the comfort class.
      x-extensible-enum:
        - BEST
        - HIGH
        - STANDARD
        - BASIC

    CombinationTag:
      type: object
      additionalProperties: false
      description: >-
        Tag to indicate that some products from a provider can be sold only when in conjunction
        with product(s) from another provider using the same tag. At least one, not all, 
        combinationTags must be in common to allow combination. No combinationTags indicate 
        that there are no combination constraints on the product.
      properties:
        id:
          type: string
        needsToBeCombined:
          description: >-
            If false it means that this product can be sold also when not in conjunction with
            a product with the same tag. This is needed to propose specific products from one 
            provider that depend on public ones of another.
          type: boolean
          default: false

    Condition:
      type: object
      additionalProperties: false
      description: >-
        Describes sales and after sales conditions applicable to the product. 
        For a product to be refundable or exchangeable, at least one refund or exchange 
        (respectively) condition must be present.
      required:
        - type
        - description
      properties:
        type:
          $ref: "#/components/schemas/ConditionType"
        description:
          type: string

    ConditionType:
      type: string
      x-extensible-enum:
        - SALE
        - PLACE_CHANGE
        - FULFILLMENT
        - EXCHANGE
        - REFUND
        - TRAVEL

    BookingPatchRequest:
      type: object
      additionalProperties: false
      description: >-
        Allows setting the required fulfillment type, e.g. value paper
        or e-ticket and preferred fulfillment media. 
        The latter is optional and relevant in some cases only.
      required:
        - exchangeOffers
      properties:
        promotionCodes:
          type: array
          items:
            $ref: "#/components/schemas/PromotionCode"
        requestedFulfillmentType:
          $ref: "#/components/schemas/FulfillmentType"
        preferredFulfillmentMedia:
          $ref: "#/components/schemas/FulfillmentMediaType"
        exchangeOffers:
          type: array
          items:
            $ref: "#/components/schemas/OfferSelection"

    ## Fulfillment

    Fulfillment:
      type: object
      additionalProperties: false
      description: >-
        A fulfillment is a document (or part of a document in allocator mode) that
        - allows the passenger to prove its travel right
        - provides easier access to trains and stations
        - allows an exchange for other services (voucher)
        A fulfillment refers to services of one or multiple offer parts or a fare (allocator mode).
      required:
        - id
      properties:
        id:
          type: string
        abstract:
          type: string
          description: A human-readable description of the fulfillment.
          example: e-ticket 12345
        status:
          $ref: "#/components/schemas/FulfillmentStatus"
        controlNumber:
          type: string
          description: Ticket Control Number.
        offerParts:
          type: array
          items:
            $ref: "#/components/schemas/OfferPartReference"
        documents:
          description: Final document created for fulfillment.
          type: array
          items:
            $ref: "#/components/schemas/FulfillmentDocument"
        fulfillmentItems:
          description: Fulfillment items to be integrated into tickets (allocator mode).
          type: array
          items:
            $ref: "#/components/schemas/FulfillmentItem"
        _links:
          type: array
          items:
            $ref: "#/components/schemas/Link"

    FulfillmentStatus:
      type: string
      enum:
        - CONFIRMED
        - FULFILLED
        - CHECKEDIN
        - REFUNDED

    FulfillmentDocument:
      type: object
      additionalProperties: false
      description: >-
        Document created for fulfillment. Either downloadLink + downloadExpiry or content + format must
        be provided.
      properties:
        medium:
          $ref: "#/components/schemas/FulfillmentMediaType"
        type:
          type: string
          x-extensible-enum:
            - BOOKING_RECEIPT
            - TICKET
            - BOARDING_PASS
            - INFORMATION
            - VOUCHER
        downloadLink:
          type: string
          format: uri
        downloadExpiry:
          type: string
          format: date-time
          description: >-
            Expiration time of the download link, the document will not be available at the given URI 
            after this time.
        content:
          type: string
          format: base64
          description: base64 encoded binary of the actual fulfillment document
        format:
          type: string
          example: "application/pdf"
          description: >-
            Physical format of the document provided in the content field in Mime-Type format, e.g. 
            application/pdf, image/jpeg, etc. Must be filled if the "content" field is present.

    FulfillmentItem:
      type: object
      additionalProperties: false
      description: >-
        Fulfillment items to be integrated in to tickets, 
        e.g. visual security elements, additional bar codes, control keys.
      properties:
        fulfillmentMedia:
          description: >-
            list of fulfillment media where this item applies
          type: array
          items:
            $ref: "#/components/schemas/FulfillmentMediaType"
        passengerReference:
          description: reference to a passenger
          type: string
        controlId:
          type: string
        securityFeatures:
          description: "visual elements, bar codes"
          type: array
          items:
            type: object
            properties:
              type:
                $ref: "#/components/schemas/SecurityFeatureType"
              data:
                description: base 64 encoded data
                type: string
        securityFeatureLinks:
          type: array
          items:
            type: object
            properties:
              type:
                $ref: "#/components/schemas/SecurityFeatureType"
              uri:
                description: link to download the security feature
                type: string
                format: uri
        isMandatory:
          description: >-
            The use of the provided features is mandatory.
          type: boolean
          default: false
        securePaperOnly:
          description: >-
            The security feature must be used on secure paper.
          type: boolean
          default: false

    FulfillmentMediaType:
      type: string
      description: >-
        Fulfillment types. RCT2, RCCST and UIC_PDF are official UIC standards.
      x-extensible-enum:
        - RCT2
        - RCCST
        - UIC_PDF
        - PDF_A4
        - PKPASS
        - TICKETLESS

    SecurityFeatureType:
      type: object
      additionalProperties: false
      description: >-
        Defines type and format of the security feature.
      properties:
        type:
          type: string
          enum:
            - VISUAL_ELEMENT
            - BAR_CODE
        format:
          type: string
          enum:
            - PNG
            - GIF
            - SVG

    FulfillmentOption:
      type: object
      additionalProperties: false      
      description: >-
        CIT paper implies printing on value paper which is stock controlled.
      properties:
        type:
          $ref: "#/components/schemas/FulfillmentType"
        media:
          type: array
          items:
            $ref: "#/components/schemas/FulfillmentMediaType"

    #### Common elements start
    ## Referenced by distributor as well as allocator part

    CountryCode:
      type: string
      description: ISO country code (2 alpha), relative URNs with base urn:iso:std:iso:3166 are recommended
      example: DE

    FareConnectionPoint:
      type: object
      additionalProperties: false
      description: >-
        Connection point connecting two fare regimes. The connection is possible between stations of the two provided station sets.
        A legacy border point code (id) might be provided as an additional code within the stations (code list BORDER_POINT provided in URN). 
        In case the connection point is a real station this station is indicated. 
        In case the connection point is between stations for each side of the border real stations must be provided. 
        Multiple sets of station can be provided in the rare case that the connection point connects more than two station (A-B and A-C).
        Multiple stations within a set at one side of the border might be provided in case of changes (new stations build near the border). 

        Providing the UIC code for the station is mandatory.
      required:
        - stationSets
      properties:
        name:
          type: string
        stationSets:
          type: array
          items:
            type: array
            items:
              $ref: "#/components/schemas/StopPlaceRef" # EXT Changed from StopPoint
 
    GeoPosition:
      type: object
      additionalProperties: false
      description: >-
        WGS84 coordinates position. Provided by OJP.
      required:
        - latitude
        - longitude
      properties:
        longitude:
          $ref: "#/components/schemas/Longitude"
        latitude:
          $ref: "#/components/schemas/Latitude"
        # altitude:   # Out of scope
        #   $ref: "#/components/schemas/Altitude"
        # precision:   # Out of scope
        #   $ref: "#/components/schemas/Precision"

    Longitude:
      type: number
      description: Longitude from Greenwich Meridian. -180 (West) to +180 (East). Decimal degrees. eg 2.356.
      format: float
      example: 8.54021
      minimum: -180.0
      maximum: 180.0

    Latitude:
      type: number
      description: Latitude from equator. -90 (South) to +90 (North). Decimal degrees. eg 56.356.
      format: float
      example: 47.37818
      minimum: -90.0
      maximum: 90.0

    Link:
      type: object
      description: >-
        The underlying system may provide links for pagination of links pointing on 
        further information (such as HTML download links, web sites or extended APIs).
        Mechanism to add flexible extensions specific to an underlying system. Implemented
        the JSON-HAL specification.
      additionalProperties:
        $ref: "#/components/schemas/LinkObject"

    LinkObject:
      type: object
      additionalProperties: false
      required:
        - href
      properties:
        type:
          type: string
          description: >-
            Hint to indicate the media type expected when dereferencing the target resource.
          example: application/json
        href:
          type: string
          format: uri
          description: A URI
          example:
            - "https://api.osdm.com/trips-collections/12345?cursor=2"
            - "https://api.osdm.com/trips-collections/12345?cursor=0"

    WarningCollection:
      type: array
      description: >-
        List of warnings.
      items:
        $ref: "#/components/schemas/Warning"

    Warning:
      type: object
      additionalProperties: false
      description: >-
        This element can be used to pass non-blocking information or events,
        such as a price difference with the initially offered price at booking time. 
        It is inspired on the JSon problem structure.
      required:
        - code
      properties:
        code:
          type: string
        type:
          type: string
          format: uri
          description: >-
            An absolute URI that identifies the warning type. When dereferenced,
            it SHOULD provide human-readable documentation for the problem type
            (e.g., using HTML).
          default: "about:blank"
          example: "https://example.com/warns/price-updated"
        detail:
          type: string
          description: >-
            A human readable explanation specific to this occurrence of the
            warning.
          example: The price of the given offer part has been updated during the booking operation
        instance:
          type: string
          format: uri
          description: >-
            An absolute URI that identifies the specific occurrence of the warning.
            example: offers/offer1234

    Problem:
      type: object
      additionalProperties: false
      description: >-
        Problem Details for HTTP APIs (RFC 7807) defines a "problem detail" as a way
        to carry machine-readable details of errors in a HTTP response to avoid
        the need to define new error response formats for HTTP APIs.
        See: https://tools.ietf.org/html/rfc7807
      properties:
        type:
          type: string
          format: uri
          description: >-
            An absolute URI that identifies the problem type. When dereferenced,
            it SHOULD provide human-readable documentation for the problem type
            (e.g., using HTML).
          default: "about:blank"
          example: "https://example.com/probs/passenger-too-young"
        title:
          type: string
          description: >-
            A short, summary of the problem type. Written in English and readable
            for engineers (usually not suited for non technical stakeholders and
            not localized); example: Service Unavailable
        status:
          type: integer
          format: int32
          description: >-
            The HTTP status code generated by the origin server for this occurrence
            of the problem.
          minimum: 100
          maximum: 600
          exclusiveMaximum: true
          example: 503
        detail:
          type: string
          description: >-
            A human readable explanation specific to this occurrence of the
            problem.
          example: Connection to database timed out
        instance:
          type: string
          format: uri
          description: >-
            An absolute URI that identifies the specific occurrence of the problem.
